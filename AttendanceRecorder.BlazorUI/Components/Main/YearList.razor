<h2>Years</h2>

@if (_years == null)
{
    <p>Loading years...</p>
}
else
{
    <ul class="list-unstyled selection-list">
        @foreach (var year in _years)
        {
            <li>
                <button type="button"
                        class="btn selection-list-btn @(year == _selectedYear ? "btn-primary" : "btn-secondary")"
                        @onclick="() => SelectYear(year)"
                        aria-pressed="@(year == _selectedYear)"
                        aria-label="Select year @year">
                    @year
                </button>
            </li>
        }
    </ul>
}

@code {
    private IEnumerable<int>? _years;
    private int? _selectedYear;

    [Parameter] public EventCallback<int> SelectedYearChanged { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var apiClient = new ApiClient("http://localhost:5225", new HttpClient());
        _years = (await apiClient.YearsAsync()).OrderByDescending(y => y);
        _selectedYear = _years.FirstOrDefault();
        if (_selectedYear.HasValue)
        {
            await SelectedYearChanged.InvokeAsync(_selectedYear.Value);
        }
    }

    private async Task SelectYear(int year)
    {
        if (_selectedYear == year)
        {
            return;
        }

        _selectedYear = year;
        await SelectedYearChanged.InvokeAsync(year);
    }
}